import se.nbis.lega.deployment.ClearConfigurationTask
import se.nbis.lega.deployment.DeployStackTask
import se.nbis.lega.deployment.RemoveStackTask
import se.nbis.lega.deployment.cega.Config
import se.nbis.lega.deployment.cega.CreateEurekaConfigurationTask
import se.nbis.lega.deployment.cega.CreateMQConfigurationTask
import se.nbis.lega.deployment.cega.CreateUsersConfigurationTask

import java.util.stream.Collectors

task clearConfiguration(type: ClearConfigurationTask) {
    group "cega"

    setConfigs Arrays.stream(Config.values()).map { c -> c.getName() }.collect(Collectors.toSet())
}

task createEurekaConfiguration(type: CreateEurekaConfigurationTask)

task createUsersConfiguration(type: CreateUsersConfigurationTask)

task createMQConfiguration(type: CreateMQConfigurationTask)

task createConfiguration {
    group "cega"

    dependsOn clearConfiguration, createEurekaConfiguration, createUsersConfiguration, createMQConfiguration
}

task deployStack(type: DeployStackTask) {
    group "cega"

    setComposeFile file("docker-stack.yml").absolutePath
    setStackName "cega"
    setEnvironment "LEGA_INSTANCES": "lega", "CEGA_REST_lega_PASSWORD": readTrace("CEGA_REST_PASSWORD")
}

task removeStack(type: RemoveStackTask) {
    group "cega"

    setStackName "cega"
}